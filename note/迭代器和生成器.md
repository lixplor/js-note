# 迭代器和生成器

## 迭代器 (Iterator)

* `Iterator`迭代器是一个对象
    - `Iterator(对象或数组)`
    - `Iterator(对象或数组, boolean)`: 如果只要key, 则第二个参数为true
* 方法
    - `next:`方法: 返回序列中的下一项
        - `done`属性: 是否迭代完毕
        - `value`属性: 值
* `for...in`循环可以取代next方法

```javascript
// 迭代器
function makeIterator(array){
    var nextIndex = 0;
    return {
        next: function(){
            return nextIndex < array.length?
                {value:array[nextIndex++], done:false}:
                {done:true};
        }
    }
}

// next
var it = makeIterator(['yo', 'ya']);
console.log(it.next().value); // yo
console.log(it.next().value); // ya
console.log(it.next().done);  // true

// for...in
var langs = ['JavaScript', 'Python', 'C++'];
var it = Iterator(langs);
for (var pair in it)
  console.log(pair);
```

### 自定义迭代器

* 为了实现特定情况的遍历, 可以自定义迭代器
    - 遍历一个序列对象时应该是一个接着一个。
    - 遍历一棵树时应该使用深度优先或者广度优先方式。
    - 遍历一个数据库查询结果对象时应该是一条一条地遍历，即使整个结果并没有被加载到一个数组中
    - 一个迭代器在一个无限的数学序列(如斐波那契序列)应该能够一个一个地返回结果而不创建一个无限长度的数据结构

```javascript
// 自定义迭代器, 从low开始, 依次递增遍历数列, 当超出上限时抛出异常
function Range(low, high){
  this.low = low;
  this.high = high;
}
function RangeIterator(range){
  this.range = range;
  this.current = this.range.low;
}
RangeIterator.prototype.next = function(){
  if (this.current > this.range.high)
    throw StopIteration;
  else
    return this.current++;
};
Range.prototype.__iterator__ = function(){
  return new RangeIterator(this);
};
var range = new Range(3, 5);
for (var i in range)
  console.log(i); // prints 3, then 4, then 5 in sequence
```

## 生成器 (Generator)

* `function* 函数名`定义一个`generator`生成器函数
* 相对于迭代器, 可以保存内部状态
* 生成器是一种特殊类型的`函数`, 该函数作为迭代器工作的工厂
* 如果函数包含了一个或一个以上的`yield`表达式, 那么这个函数就是一个`生成器`
* 生成器函数被调用时并不会马上执行, 而是返回一个`generator-iterator`对象, 每次调用其`next()`方法至下一个yield表达式并返回一个结果. 当执行完毕或执行到return时抛出`StopIteration`异常
* **注意:** `yield`关键字只能在` <script type="application/javascript;version=1.7">`代码块中有效

```javascript
function* simpleGenerator(){
  yield "first";
  yield "second";
  yield "third";
  for (var i = 0; i < 3; i++)
    yield i;
}

var g = simpleGenerator();
console.log(g.next()); // prints "first"
console.log(g.next()); // prints "second"
console.log(g.next()); // prints "third"
console.log(g.next()); // prints 0
console.log(g.next()); // prints 1
console.log(g.next()); // prints 2
console.log(g.next()); // StopIteration is thrown
```
